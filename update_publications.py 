from scholarly import scholarly
from bs4 import BeautifulSoup

# ========== ğŸ§© 1. åœ¨è¿™é‡Œè¾“å…¥ä½œè€…åå­—ï¼ˆå¯æ”¹ä¸ºä½ çš„ä»»ä½•æˆå‘˜ï¼‰ ==========
AUTHOR_NAME = "Davide Lombardi"

# ========== ğŸ§© 2. æœç´¢è¯¥ä½œè€…å¹¶è·å–ä¿¡æ¯ ==========
print(f"ğŸ” Searching for author: {AUTHOR_NAME} ...")
search_query = scholarly.search_author(AUTHOR_NAME)
author = next(search_query, None)

if not author:
    print("âŒ Author not found. Try a more specific name (e.g., 'Davide Lombardi Xiâ€™an Jiaotong')")
    exit()

# åŠ è½½ä½œè€…çš„å‡ºç‰ˆç‰©
author = scholarly.fill(author, sections=['publications'])
print(f"âœ… Found author: {author['name']}")

# ========== ğŸ§© 3. ç”Ÿæˆ HTML ==========
soup = BeautifulSoup("<div class='publication-list'></div>", "html.parser")
pub_list = soup.div

for pub in author['publications'][:10]:  # åªå–å‰10ç¯‡
    title = pub.get('bib', {}).get('title', 'Untitled')
    year = pub.get('bib', {}).get('pub_year', 'â€”')
    venue = pub.get('bib', {}).get('venue', '')
    pub_url = pub.get('pub_url', '#')

    pub_div = soup.new_tag('div', **{'class': 'publication-item'})
    pub_div.append(soup.new_tag('h3'))
    pub_div.h3.string = title

    meta_p = soup.new_tag('p')
    meta_p.string = f"{venue} ({year})"
    pub_div.append(meta_p)

    link_a = soup.new_tag('a', href=pub_url, target='_blank')
    link_a.string = "View on Google Scholar"
    pub_div.append(link_a)

    pub_list.append(pub_div)

# ========== ğŸ§© 4. è¾“å‡ºç»“æœåˆ°æ–‡ä»¶ ==========
with open("publications_generated.html", "w", encoding="utf-8") as f:
    f.write(soup.prettify())

print("ğŸ‰ Done! File saved as publications_generated.html")
